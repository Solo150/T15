{% extends "coderedcms/pages/base.html" %}
{% load static %}

{% block custom_assets %}
{# Add your custom CSS here #}
<link rel="stylesheet" type="text/css" href="{% static 'website/css/genstyle.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'website/css/custom.css' %}">
<link rel="stylesheet" href="{% static 'website/css/swiper-bundle.css' %}" />
<link rel="stylesheet" href="{% static 'website/css/swiper-bundle.min.css' %}" />
{% if self.custom_css %}
	<link rel="stylesheet" href="{% static 'website/css' %}/{{ self.custom_css }}.css" />
{% endif %}
{% endblock %}

{% block custom_scripts %}
{# Add your custom JavaScript here, or delete the line below if you don't need any #}
<script type="text/javascript" src="{% static 'website/js/custom.js' %}"></script>
<script src="{% static 'website/js/swiper-bundle.js' %}"></script>
<script src="{% static 'website/js/swiper-bundle.min.js' %}"></script>
<script type="text/javascript" src="{% static 'website/js/lozad.min.js' %}"></script>
<script>
  const observer = lozad('.lazy');
  observer.observe();
</script>
<script>
if (document.documentElement.clientWidth > 991) {
const swiper6 = new Swiper('.swiper-container6', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 6,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper5 = new Swiper('.swiper-container5', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 5,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper4 = new Swiper('.swiper-container4', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 4,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper3 = new Swiper('.swiper-container3', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 3,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper2 = new Swiper('.swiper-container2', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 2,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper1 = new Swiper('.swiper-container1', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 1,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
} else {
const swiper6 = new Swiper('.swiper-container6', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 2,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper5 = new Swiper('.swiper-container5', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 2,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper4 = new Swiper('.swiper-container4', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 1,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper3 = new Swiper('.swiper-container3', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 1,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper2 = new Swiper('.swiper-container2', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 1,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
const swiper1 = new Swiper('.swiper-container1', {
  // Optional parameters
  direction: 'horizontal',
  loop: true,
  slidesPerView: 1,

  // If we need pagination
  pagination: {
    el: '.swiper-pagination',
  },

  // Navigation arrows
  navigation: {
    nextEl: '.swiper-button-next',
    prevEl: '.swiper-button-prev',
  },

  // And if we need scrollbar
  scrollbar: {
    el: '.swiper-scrollbar',
  },
});
};
</script>
{% endblock %}
{% block shop_custom %}
 
        <script>
    


( function ( window, document, undefined ) {
    

		
  
	
	// load session
	var appID = "com.dynamicov.pwa",
		session = localStorage.getItem( appID );

	if ( session && session.added ) {
		return;
	}

	window.addEventListener( "beforeinstallprompt", beforeInstallPrompt );

	var platform = {},
		defaultPrompt = {
			title: "У нас появилось замечательное приложение",
			descriptions: "Скачайте его для легкого и удобного доступа к покупкам",
			installMsg: "Установить приложение",
			installedTitle: "У вас уже установлено наше приложение",
			installedDescriptions: "Поищите его на вашем смартфоне или следуйте инструкции",
			pushTitle: "Подпишитесь на уведомления",
			pushDescription: "Мы будем отправлять вам полезные акции",
			pushButton: "Подписаться",
		};

	function checkPlatform() {

		// browser info and capability
		var _ua = window.navigator.userAgent;

		
		platform.isIDevice = ( /iphone|ipod|ipad/i ).test( _ua );
		platform.isAndroid = /android/i.test( _ua );
		platform.isWindowsPhone = /Windows Phone/i.test( _ua );
		
		platform.isSamsung = /Samsung/i.test( _ua );
		platform.isChrome = /chrome/i.test( _ua );
		platform.isFireFox = /Firefox/i.test( _ua );
		platform.isOpera = /opr/i.test( _ua );
		platform.isEdge = /edg/i.test( _ua );
		platform.isInApp = /cordova/i.test( _ua );
        
		// Opera & FireFox only Trigger on Android
		if ( platform.isFireFox ) {
			platform.isFireFox = /android/i.test( _ua );
		}

		if ( platform.isOpera ) {
			platform.isOpera = /android/i.test( _ua );
		}


		platform.isInWebAppiOS = ( window.navigator.standalone === true );
		platform.isInWebAppChrome = ( window.matchMedia( '(display-mode: standalone)' ).matches );
		platform.isMobileSafari = platform.isIDevice && _ua.indexOf( 'Safari' ) > -1 && _ua.indexOf( 'CriOS' ) < 0;
		platform.isStandalone = platform.isInWebAppiOS || platform.isInWebAppChrome;
		platform.isiPad = ( platform.isMobileSafari && _ua.indexOf( 'iPad' ) > -1 );
		platform.isiPhone = ( platform.isMobileSafari && _ua.indexOf( 'iPad' ) === -1 );
		platform.isCompatible = ((platform.isChrome || platform.isMobileSafari || platform.isSamsung || platform.isFireFox || platform.isOpera) && (platform.isIDevice || platform.isAndroid || platform.isWindowsPhone) ) ;
        
		$('#console').append("<small>"+JSON.stringify(platform).split(',').join('<br>')+"</small>");
			

	}

	/* displays native A2HS prompt & stores results */
	function triggerNativePrompt() {

		return _beforeInstallPrompt.prompt()
			.then( function ( evt ) {

				// Wait for the user to respond to the prompt
				return _beforeInstallPrompt.userChoice;

			} )
			.then( function ( choiceResult ) {

				session.added = ( choiceResult.outcome === "accepted" );

				if ( session.added ) {
					_instance.doLog( "User accepted the A2HS prompt" );

					if ( _instance.options.onAdd ) {
						_instance.options.onAdd();
					}

				} else {

					if ( _instance.options.onCancel ) {
						_instance.options.onCancel();
					}

					session.optedout = true;
					_instance.doLog( "User dismissed the A2HS prompt" );
				}

				_instance.updateSession();

				_beforeInstallPrompt = null;

			} )
			.catch( function ( err ) {

				_instance.doLog( err.message );

				if ( err.message.indexOf( "user gesture" ) > -1 ) {
					_instance.options.mustShowCustomPrompt = true;
					_instance.options.mustShowInstructions = true;
					_instance._delayedShow();
				}

			} );
	}

	function getPlatform( native ) {

		if ( _instance.options.debug &&
			typeof _instance.options.debug === "string" ) {
			return _instance.options.debug;
		}
		
		if(platform.isIDevice || platform.isAndroid || platform.isWindowsPhone){
	        if ( platform.isInApp ) {
		    	return "InApp";
		    }
		    else if ( platform.isChrome && ( native === undefined && !native ) ) {
			    return "native";
		    } else if ( platform.isFireFox ) {
		    	return "firefox";
		    } else if ( platform.isiPad ) {
		    	return "ipad";
		    } else if ( platform.isiPhone ) {
		    	return "iphone";
		    } else if ( platform.isOpera ) {
		    	return "opera";
		    } else if ( platform.isSamsung ) {
		    	return "samsung";
		    } else if ( platform.isEdge ) {
		    	return "edge";
		    } else if ( platform.isChrome ) {
		    	return "Chrome";
		    } else {
		    	return "undefined";
		    }
		} else {
		    	return "computer";
		}
		

		

	}


	//can be used to calculate the next prime number, a possible way to calculate when to next prompt
	function nextPrime( value ) {

		while ( true ) {

			var isPrime = true;

			if ( isNaN( value ) ) {
				value = 0;
			}

			//increment the number by 1 each time
			value += 1;

			var squaredNumber = Math.sqrt( value );

			//start at 2 and increment by 1 until it gets to the squared number
			for ( var i = 2; i <= squaredNumber; i++ ) {

				//how do I check all i's?
				if ( value % i == 0 ) {
					isPrime = false;
					break;
				}

			}

			if ( isPrime ) {
				return value;
			}

		}
	}

	// singleton
	var _instance;

	function ath( options ) {

		//prevent duplicate instances
		_instance = _instance || new ath.Class( options );

		return _instance;
	}

	// default options
	ath.defaults = {
	    siteUrl : '',
		appID: appID, // local storage name (no need to change)
		appName: "Dynamicov PWA",
		debug: false, // override browser checks
		logging: false, // log reasons for showing or not showing to js console; defaults to true when debug is true
		modal: false, // prevent further actions until the message is closed
		mandatory: false, // you can't proceed if you don't add the app to the homescreen
		autostart: true, // show the message automatically
		skipFirstVisit: false, // show only to returning visitors (ie: skip the first time you visit)
		minSessions: 0, //show only after minimum number of page views
		startDelay: 1, // display the message after that many seconds from page load

		displayPace: 1440, // minutes before the message is shown again (0: display every time, default 24 hours)
		displayNextPrime: false,
		mustShowCustomPrompt: true,
		mustShowInstructions: false,
		maxDisplayCount: 0, // absolute maximum number of times the message will be shown to the user (0: no limit)
		validLocation: [], // list of pages where the message will be shown (array of regexes)
		onInit: null, // executed on instance creation
		onShow: null, // executed when the message is shown
		onAdd: null, // when the application is launched the first time from the homescreen (guesstimate)
		onInstall: null,
		onCancel: null,
		
		onPushInit: null,
		onPushAccept: null,
		onPushAlertShow: null,
		onPushCancel :null,
		skipFirstVisitPush: false,
		minSessionsPush: 0,
		startDelayPush: 1,
		displayPushPace: 1440,
		maxDisplayPushCount: 0,
		
		
		customCriteria: null,
		manualPrompt: null,
		customPrompt: {}, //allow customization of prompt content
		athWrapper: ".dynamicovPWA_notification",
		showClass: "dynamicovPWA_notification_active",
		showButtonClass: "dynamicovPWA_notification--show-button",
		showInstructionClass: "dynamicovPWA_notification--show-instruction",
		
		
		promptDlg: {
			title: ".dynamicovPWA_notification_title",
			descriptions: ".dynamicovPWA_notification_description",
			body: ".dynamicovPWA_notification_container",
			instructions: ".dynamicovPWA_notification_instalinstructions",
			cancel: ".dynamicovPWA_notification_close", 
			mask: ".dynamicovPWA_notification_mask",
			install: "#dynamicovPWA_notification_installbutton",
			
		},
		prompt: {
		    "native": {
		         instruction: "Для установки откройте меню <span class='dynamicovPWA_notification_icon'><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'><title>ionicons-v5-f</title><circle cx='256' cy='256' r='48'/><circle cx='256' cy='416' r='48'/><circle cx='256' cy='96' r='48'/></svg></span> и коснитесь пункта «Добавить главный экран».",
			},
			"edge": {
			    instruction: "Для установки коснитесь иконки <span class='dynamicovPWA_notification_icon'><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'><title>ionicons-v5-a</title><path d='M448,256c0-106-86-192-192-192S64,150,64,256s86,192,192,192S448,362,448,256Z' style='fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:32px'/><line x1='256' y1='176' x2='256' y2='336' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><line x1='336' y1='256' x2='176' y2='256' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/></svg></span> «Добавить на главный экран».",

			},
			"chrome": {
			    instruction: "Для установки откройте меню <span class='dynamicovPWA_notification_icon'><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'><title>ionicons-v5-f</title><circle cx='256' cy='256' r='48'/><circle cx='256' cy='416' r='48'/><circle cx='256' cy='96' r='48'/></svg></span> и коснитесь пункта «Добавить главный экран».",
				
			},
			"iphone": {
			    instruction: "Для установки нажмите <span class='dynamicovPWA_notification_icon'><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 400 512'><path d='M336,192h40a40,40,0,0,1,40,40V424a40,40,0,0,1-40,40H136a40,40,0,0,1-40-40V232a40,40,0,0,1,40-40h40' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><polyline points='336 128 256 48 176 128' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><line x1='256' y1='321' x2='256' y2='48' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/></svg></span>, затем коснитесь «Добавить на экран 'Домой'».",
			},
			"ipad": {
			    instruction: "Для установки нажмите <span class='dynamicovPWA_notification_icon'><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 400 512'><path d='M336,192h40a40,40,0,0,1,40,40V424a40,40,0,0,1-40,40H136a40,40,0,0,1-40-40V232a40,40,0,0,1,40-40h40' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><polyline points='336 128 256 48 176 128' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><line x1='256' y1='321' x2='256' y2='48' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/></svg></span>, затем коснитесь «Добавить на экран 'Домой'».",
			},
			"firefox": {
			    instruction: "Для установки коснитесь иконки <span class='dynamicovPWA_notification_icon'><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'><title>ionicons-v5-a</title><path d='M448,256c0-106-86-192-192-192S64,150,64,256s86,192,192,192S448,362,448,256Z' style='fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:32px'/><line x1='256' y1='176' x2='256' y2='336' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><line x1='336' y1='256' x2='176' y2='256' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/></svg></span> «Добавить на главный экран».",
                // https://2048.love2dev.com/imgs/firefox-a2hs-icon.png
			
			},
			"samsung": {
			    instruction: "Для установки коснитесь иконки <span class='dynamicovPWA_notification_icon'><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'><title>ionicons-v5-a</title><path d='M448,256c0-106-86-192-192-192S64,150,64,256s86,192,192,192S448,362,448,256Z' style='fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:32px'/><line x1='256' y1='176' x2='256' y2='336' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><line x1='336' y1='256' x2='176' y2='256' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/></svg></span> «Добавить на главный экран».",
			    //   https://2048.love2dev.com/imgs/samsung-internet-a2hs-icon.png
				
			},
			"opera": {
			    instruction: "Для установки откройте меню <span class='dynamicovPWA_notification_icon'><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'><title>ionicons-v5-f</title><circle cx='256' cy='256' r='48'/><circle cx='256' cy='416' r='48'/><circle cx='256' cy='96' r='48'/></svg></span> и коснитесь пункта «Добавить главный экран».",
			},
			"computer": {
			    instruction: "Для установки приложения на смартфон - откройте страницу при помощи мобильного браузера(Safari, Chrome) и следуйте инструкциям",
			},
			"undefined": {
			    instruction: "Для установки приложения на смартфон - откройте страницу при помощи мобильного браузера(Safari, Chrome) и следуйте инструкциям",
			}
		}
	};

	checkPlatform();

	var _defaultSession = {
		lastDisplayTime: 0, // last time we displayed the message
		returningVisitor: false, // is this the first time you visit
		displayCount: 0, // number of times the message has been shown
		optedout: false, // has the user opted out
		added: false, // has been actually added to the homescreen
		sessions: 0,
		
		sessionsPush: 0,
		optedoutPush: false,
		addedPush: false,
		returningVisitorPush: false,
		nextSessionPush: 0,
		
		nextSession: 0 //tie this to nextPrime Counter
	};

	session = session ? JSON.parse( session ) : _defaultSession;

	var _beforeInstallPrompt;

	function beforeInstallPrompt( evt ) {
	    
        
		evt.preventDefault();
		
		_instance.doLog( "Beforeinstallprompt fired" );

		_beforeInstallPrompt = evt;

	}

	ath.removeSession = function ( appID ) {

		localStorage.removeItem( appID || ath.defaults.appID );

	};

	ath.doLog = function ( logStr ) {

		if ( this.options.logging ) {

			console.log( logStr );
			$('#console').append("<p>"+logStr+"</p>");
			
		}

	};

	platform.cancelPrompt = function ( evt ) {

		evt.preventDefault();

		if ( _instance.options.onCancel ) {
			_instance.options.onCancel();
		}

		platform.closePrompt();

		return false;

	};
	
	platform.closePrompt = function () {

		var ath_wrapper = document.querySelector( _instance.options.athWrapper );

		if ( ath_wrapper ) {

			ath_wrapper.classList.remove( _instance.options.showClass);
			ath_wrapper.classList.remove( _instance.options.showButtonClass);
			ath_wrapper.classList.remove( _instance.options.showInstructionClass);

		}
		_instance.shown = false;
		_instance.updateSession();

	};

	platform.handleInstall = function ( evt ) {
        
        _instance.doLog('handleInstall');
		if ( _instance.options.onInstall ) {
			_instance.options.onInstall();
		}

		if ( _beforeInstallPrompt &&
			( !_instance.options.debug || getPlatform() === "native" ) ) {
            
			platform.closePrompt();
			triggerNativePrompt();

		}
		else{
		    _instance.options.mustShowInstructions = true;
		    _instance.updateSession();
		    _instance.doLog('restart'); 
		    platform.closePrompt();
		    _instance.trigger(true);
		    
		}

		return false;
	};
	
	platform.handlePush = function ( evt ) {
        
        
        _instance.doLog('handlePush');
		if ( _instance.options.onPushAlertShow ) {
			_instance.options.onPushAlertShow();
		}
		
		
		messaging
            .requestPermission()
            .then(function () {
                console.log("Notification Permission");
                return messaging.getToken();
            })
            .then(function (token) {
                _instance.doLog("Token : "+token);
                _instance.doLog( "User accepted the PUSH prompt" );
                if( !session.addedPush ){
                    if ( _instance.options.onPushAccept ) {
				        _instance.options.onPushAccept();
                    }
                    var xhr = new XMLHttpRequest();
                    var body = 'siteurl=' + encodeURIComponent(_instance.options.siteUrl) +
                      '&token=' + encodeURIComponent(token);
                    
                    xhr.open("POST", 'https://pushmanager.dynamicov.ru/api/addsubscriber', true);
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                    xhr.onreadystatechange = function() {
                             _instance.doLog( xhr.response );
                      
                    }
                    
                    
                    xhr.send(body);
                }
                session.addedPush = true;
               
              
               
                
                
                
            })
            .catch(function (reason) {
                session.optedoutPush = true;
                _instance.doLog( "User dismissed the PUSH prompt" );
                _instance.doLog(reason);
            });
    
		platform.closePrompt();

      
  
  

		return false;
	};
	
	


	ath.Class = function ( options ) {

		// class methods
		this.doLog = ath.doLog;

		// merge default options with user config
		this.options = Object.assign( {}, ath.defaults, options );

		var manifestEle = document.querySelector( "[rel='manifest']" );

		if ( !manifestEle ) {

			_instance.doLog( "manifestEle not found" );
			platform.isCompatible = false;
		}


        navigator.serviceWorker.register('/sw2.js', { scope: '/' }).then(afterSWCheck);
 
	};

	function afterSWCheck( sw ) {
        
		_instance.sw = sw;

		if ( !_instance.sw ) {

			_instance.doLog( "no service worker" );
			platform.isCompatible = false;
		}
         _instance.doLog('Service Worker registration success');
        
        if(platform.isStandalone){
            session.stadaloneSessions += 1;
        }
        else{
            session.sessions += 1;
        }
		_instance.updateSession();

		// override defaults that are dependent on each other
		if ( _instance.options && _instance.options.debug && ( typeof _instance.options.logging === "undefined" ) ) {
			_instance.options.logging = true;
		}

		// normalize some options
		_instance.options.mandatory = _instance.options.mandatory && ( 'standalone' in window.navigator ||
			_instance.options.debug );
			
			

		//this is forcing the user to add to homescreen before anything can be done
		//the ideal scenario for this would be an enterprise business application
		//could also be a part of an onboarding workflow for a SAAS
		_instance.options.modal = _instance.options.modal || _instance.options.mandatory;

		if ( _instance.options.mandatory ) {
			_instance.options.startDelay = -0.5; // make the popup hasty
		}

		// setup the debug environment
		if ( _instance.options.debug ) {

			platform.isCompatible = true;

		}
        
        if(platform.isStandalone){
            if ( _instance.options.onPushInit ) {
		    	_instance.options.onPushInit.call( _instance );
		    }
        }
        else{
            if ( _instance.options.onInit ) {
		    	_instance.options.onInit.call( _instance );
		    }
        }
        
		if ( _instance.options.autostart ) {
			_instance.doLog( "Add to homescreen: autostart displaying callout" );
			_instance.show();
		}
        
		

	}

	ath.Class.prototype = {

		_canPrompt: undefined,
		_canPromptPush: undefined,

		canPrompt: function () {
		  

			//already evaluated the situation, so don't do it again
			if ( this._canPrompt !== undefined ) {
				return this._canPrompt;
			}

			this._canPrompt = false;

			if ( _instance.options.customCriteria !== null || _instance.options.customCriteria !== undefined ) {

				var passCustom = false;

				if ( typeof _instance.options.customCriteria === "function" ) {
					passCustom = _instance.options.customCriteria();
				} else {
					passCustom = !!_instance.options.customCriteria;
				}

				if ( !passCustom ) {

					this.doLog( "Add to homescreen: not displaying callout because a custom criteria was not met." );
					return false;

				}

			}

			//using a double negative here to detect if service workers are not supported
			//if not then don't bother asking to add to install the PWA
			if ( !( "serviceWorker" in navigator ) ) {

				this.doLog( "Add to homescreen: not displaying callout because service workers are not supported" );
				return false;

			}

			// the device is not supported
			if ( !platform.isCompatible ) {
			    
				this.doLog( "Add to homescreen: not displaying callout because device not supported" );
				return false;
			}

			var now = Date.now(),
				lastDisplayTime = session.lastDisplayTime;

			// we obey the display pace (prevent the message to popup too often)
			if ( now - lastDisplayTime < this.options.displayPace * 60000 ) {
				this.doLog( "Add to homescreen: not displaying callout because displayed recently" );
				return false;
			}

			// obey the maximum number of display count
			if ( this.options.maxDisplayCount && session.displayCount >= this.options.maxDisplayCount ) {
				this.doLog( "Add to homescreen: not displaying callout because displayed too many times already" );
				return false;
			}

			// check if this is a valid location
			// TODO: should include at least the home page here
			// by default all pages are valid, which can cause issues on iOS
			// TODO: maybe trigger a redirect back to the home page for iOS
			var isValidLocation = !this.options.validLocation.length;

			for ( var i = this.options.validLocation.length; i--; ) {

				if ( this.options.validLocation[ i ].test( document.location.href ) ) {
					isValidLocation = true;
					break;
				}

			}

			if ( !isValidLocation ) {
				this.doLog( "Add to homescreen: not displaying callout because not a valid location" );
				return false;
			}

			if ( session.sessions < this.options.minSessions ) {
				this.doLog( "Add to homescreen: not displaying callout because not enough visits" );
				return false;
			}

			if ( ( this.options.nextSession && this.options.nextSession > 0 ) &&
				session.sessions >= this.options.nextSession ) {
				this.doLog( "Add to homescreen: not displaying callout because waiting on session " + this.options.nextSession );
				return false;
			}

			// critical errors:
			if ( session.optedout ) {
				this.doLog( "Add to homescreen: displaying instructions because user opted out" );
				return false;
			}

			if ( session.added ) {
				this.doLog( "Add to homescreen: not displaying callout because already added to the homescreen" );
				return false;
			}

			// check if the app is in stand alone mode
			//this applies to iOS
			if ( platform.isStandalone ) {

				// execute the onAdd event if we haven't already
				if ( !session.added ) {

					session.added = true;
					this.updateSession();

					if ( this.options.onAdd ) {
						this.options.onAdd.call( this );
					}

				}

				this.doLog( "Add to homescreen: not displaying callout because in standalone mode" );
				return false;
			}

			// check if this is a returning visitor
			if ( !session.returningVisitor ) {

				session.returningVisitor = true;
				this.updateSession();

				// we do not show the message if this is your first visit
				if ( this.options.skipFirstVisit ) {
					this.doLog( "Add to homescreen: not displaying callout because skipping first visit" );
					return false;
				}

			}

			this._canPrompt = true;

			return true;

		},
		
		canPromptPush: function () {
		  

			//already evaluated the situation, so don't do it again
			if ( this._canPromptPush !== undefined ) {
				return this._canPromptPush;
			}

			this._canPromptPush = false;
        
        	this.doLog('Notification' in window);

			//using a double negative here to detect if notification are not supported
			if (!( 'Notification' in window ) ) {
				this.doLog( "Notifications: this browser does not support notifications." );
				return false;
			}

			// the device is not supported
			if ( platform.isIphone || platform.isIpad) {
			    
				this.doLog( "Notifications: not displaying callout because device not supported" );
				return false;
			}

			var now = Date.now(),
				lastDisplayTimePush = session.lastDisplayTimePush;

			// we obey the display pace (prevent the message to popup too often)
			if ( now - lastDisplayTimePush < this.options.displayPushPace * 60000 ) {
				this.doLog( "Notifications: not displaying callout because displayed recently" );
				return false;
			}

			// obey the maximum number of display count
			if ( this.options.maxDisplayPushCount && session.displayPushCount >= this.options.maxDisplayPushCount ) {
				this.doLog( "Notifications: not displaying callout because displayed too many times already" );
				return false;
			}
			
				// check if the app is in stand alone mode
			if (!platform.isStandalone ) {
				this.doLog( "Notifications: not displaying callout because not in standalone mode" );
				return false;
			}
			
			if ( session.sessionsPush < this.options.minSessionsPush ) {
				this.doLog( "Notifications: not displaying callout because not enough visits" );
				return false;
			}

			if ( ( this.options.nextSessionPush && this.options.nextSessionPush > 0 ) &&
				session.sessionsPush >= this.options.nextSessionPush ) {
				this.doLog( "Notifications: not displaying callout because waiting on session " + this.options.nextSessionPush );
				return false;
			}

			// critical errors:
			if ( session.optedoutPush ) {
				this.doLog( "Notifications: displaying instructions because user opted out" );
				return false;
			}

			if ( session.addedPush ) {
				this.doLog( "Notifications: not displaying callout because already added to the homescreen" );
				return false;
			}

		

			// check if this is a returning visitor
			if ( !session.returningVisitorPush ) {

				session.returningVisitorPush = true;
				this.updateSession();

				// we do not show the message if this is your first visit
				if ( this.options.skipFirstVisitPush ) {
					this.doLog( "Notifications: not displaying callout because skipping first visit" );
					return false;
				}

			}

			this._canPromptPush = true;

			return true;

		},

		show: function ( force ) {
			// message already on screen
			if ( this.shown ) {
				this.doLog( "Add to homescreen: not displaying callout because already shown on screen" );
				return;
			}

			this.shown = true;
			

	        var type = 'normal';
			if(platform.isStandalone){
			     var type = 'standalone';
                // increment the display count
			    session.lastDisplayTimePush = Date.now();
			    session.displayCountPush++;

			    if ( _instance.options.displayNextPrimePush ) {
			    	session.nextSessionPush = nextPrime( session.sessionsPush );
			    }
            }
            else{
                // increment the display count
			    session.lastDisplayTime = Date.now();
			    session.displayCount++;

			    if ( _instance.options.displayNextPrime ) {
			    	session.nextSession = nextPrime( session.sessions );
			    }
            }
        
            
			this.updateSession();

			if ( document.readyState === "interactive" || document.readyState === "complete" ) {

				this._delayedShow(type);

			} else {

				document.onreadystatechange = function () {

					if ( document.readyState === 'complete' ) {

						this._delayedShow(type);

					}

				};

			}

		},

		_delayedShow: function (type = 'normal', e ) {
		    if (type == 'standalone'){
		        setTimeout( this._show.bind( this, false, 'standalone'  ), this.options.startDelayPush * 1000 + 500 );
		        
		    }
		    else{
		        setTimeout( this._show.bind(this), this.options.startDelay * 1000 + 500 );
		    }
			
		},

		_show: function (skipCanPrompt = false, type = 'normal') {
            var canShowPrompt = true;
            this.doLog( type );
            if(!skipCanPrompt){ 
               
			    if (type == 'standalone') {
			      
			       canShowPrompt = _instance.canPromptPush();
			       
			    }
			    else{
			        canShowPrompt = _instance.canPrompt();
			    }
            }
            
            if(canShowPrompt){
				if ( _beforeInstallPrompt && !_instance.options.mustShowCustomPrompt && type=='normal' ) {

					triggerNativePrompt();

				} else {

					var target = getPlatform(),
					ath_wrapper = document.querySelector( _instance.options.athWrapper );
				    this.doLog( target );
				    
					if(ath_wrapper){
					    
					    var ath_title = ath_wrapper.querySelector( _instance.options.promptDlg.title ),
							ath_description = ath_wrapper.querySelector( _instance.options.promptDlg.descriptions ),
							ath_instructions = ath_wrapper.querySelector( _instance.options.promptDlg.instructions ),
							ath_cancel = ath_wrapper.querySelector( _instance.options.promptDlg.cancel ),
							ath_mask = ath_wrapper.querySelector( _instance.options.promptDlg.mask ),
							ath_install = ath_wrapper.querySelector( _instance.options.promptDlg.install );
						
                        var promptTarget = Object.assign( {}, defaultPrompt, _instance.options.customPrompt, _instance.options.prompt[ target ] );
                        
                        // this.doLog( "<small>"+JSON.stringify( _instance.options.prompt[ target ] ).split(',').join('<br>')+"</small>");
                        
			
						if ( ath_title && promptTarget.title && type == 'normal' ) {
							ath_title.innerText = promptTarget.title;
						}
						else if ( ath_title && promptTarget.pushTitle && type == 'standalone' ) {
							ath_title.innerText = promptTarget.pushTitle;
						}
						
						if ( ath_description && promptTarget.descriptions && type == 'normal' ) {
							ath_description.innerText = promptTarget.descriptions;
						}
						else if ( ath_title && promptTarget.pushDescription && type == 'standalone' ) {
							ath_description.innerText = promptTarget.pushDescription;
						}
						
						if ( ath_install && promptTarget.installMsg && type == 'normal' ) {
							ath_install.innerText = promptTarget.installMsg;
						}
						else if ( ath_title && promptTarget.pushButton && type == 'standalone' ) {
							ath_install.innerText = promptTarget.pushButton;
						}

						if ( ath_install && type == 'normal' ) {
							ath_install.addEventListener( "click", platform.handleInstall );
						}
						else if( ath_install && type == 'standalone' ){
						    ath_install.addEventListener( "click", platform.handlePush );
						}

						if ( ath_cancel ) {
							ath_cancel.addEventListener( "click", platform.cancelPrompt );
						}
						if ( ath_mask ) {
							ath_mask.addEventListener( "click", platform.cancelPrompt );
						}
						
						ath_wrapper.classList.add( _instance.options.showClass );
						
						if( session.added && type == 'normal' ){
						        ath_title.innerText = promptTarget.installedTitle;
						    	ath_description.innerText = promptTarget.installedDescriptions;
						}
						if(target == 'computer'){
						    ath_wrapper.classList.add( _instance.options.showInstructionClass );
						    ath_wrapper.classList.remove( _instance.options.showButtonClass ); 
						    ath_instructions.innerHTML = promptTarget.instruction;
						} else{
						    if( ((target=='iphone') || session.optedout || _instance.options.mustShowInstructions ||  session.added) && type == 'normal'){
						        ath_wrapper.classList.add( _instance.options.showInstructionClass );
						        ath_wrapper.classList.remove( _instance.options.showButtonClass ); 
						        ath_instructions.innerHTML = promptTarget.instruction;
						    }
						    else{
						        ath_wrapper.classList.remove( _instance.options.showInstructionClass );
						       ath_wrapper.classList.add( _instance.options.showButtonClass ); 
						    }
						}
						
						
					}

				}

				// fire the custom onShow event
				if ( this.options.onShow ) {
					this.options.onShow.call( this );
				}
            }

			

		},

		trigger: function (type = 'normal') {

			this._show(true, type);

		},

		autoHide: function () {

// 			var target = getPlatform(),
// 				ath_wrapper = document.querySelector( _instance.options.athWrapper );
//             _instance.doLog('autoHide');
// 			if ( ath_wrapper ) {
//                 var promptTarget = Object.assign( {}, defaultPrompt, _instance.options.customPrompt, _instance.options.prompt[ target ] );
                
// 				var promptTarget = _instance.options.prompt[ target ];
				
//                 _instance.doLog( JSON.stringify(promptTarget) );
//                 ath_wrapper.classList.remove( ...promptTarget.showClass);
// 			    ath_wrapper.classList.remove( ...promptTarget.showButtonClass);
// 			    ath_wrapper.classList.remove( ...promptTarget.showInstructionClass);
			
			

// 			}

		},

		updateSession: function () {

			localStorage.setItem( this.options.appID, JSON.stringify( session ) );

		},

		clearSession: function () {
			session = _defaultSession;
			this.updateSession();
		},

		optOut: function () {
			session.optedout = true;
			this.updateSession();
		},

		optIn: function () {
			session.optedout = false;
			this.updateSession();
		},

		clearDisplayCount: function () {
			session.displayCount = 0;
			this.updateSession();
		}

	};

	// expose to the world
	window.DynamicovPWAaddToHomescreen = ath;

} )( window, document );




  DynamicovPWAaddToHomescreen( {
    siteUrl: 'pizzapwa.dynamicov.ru',
    autostart: true,
    autoHide: 0,
    logging: false,
    debug: false,
    startDelay: 1,
    displayPace: 0,
    minSessions: 0,
    minSessionsPush: 0,
	startDelayPush: 1,
	displayPushPace: 0,
	
    displayNextPrime: true,
    customCriteria: true,
    displayPace: 0,
    customPrompt: {
			title: "У нас появилось замечательное приложение",
			descriptions: "Скачайте его для легкого и удобного доступа к покупкам",
			installMsg: "Установить приложение",
			installedTitle: "У вас уже установлено наше приложение",
			installedDescriptions: "Поищите его на вашем смартфоне или следуйте инструкции",
			pushTitle: "Подпишитесь на наши уведомления",
			pushDescription: "Мы будем отправлять вам только полезные акции и классные предложения",
			pushButton: "Подписаться",
		}
  } );
  

    var firebaseConfig = {
        apiKey: "AIzaSyA-y4aK8XHox7xvbwcqDa_7yGHqL9oUxzA",
        authDomain: "dynamicovpwa.firebaseapp.com",
        databaseURL: "https://dynamicovpwa.firebaseio.com",
        projectId: "dynamicovpwa",
        storageBucket: "dynamicovpwa.appspot.com",
        messagingSenderId: "31575449630",
        appId: "1:31575449630:web:2f39cc2343d521488b4e0f",
        measurementId: "G-ZM6HNPR62J"
    };
    firebase.initializeApp(firebaseConfig);
	const messaging=firebase.messaging();
	
	messaging.onMessage((payload) => {
        console.log('Message received. ', payload);

    });
    

</script>

<style>

    .dynamicovPWA_notification{
        position: fixed;
        z-index: 999999999999;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
        overflow: hidden;
        display: none;
        box-sizing: border-box;
    }
    .dynamicovPWA_notification_active{
        display: block;
    }
    
    .dynamicovPWA_notification.dynamicovPWA_notification--show-instruction .dynamicovPWA_notification_instalinstructions{
        display: block;
    }
    .dynamicovPWA_notification.dynamicovPWA_notification--show-button .dynamicovPWA_notification_button{
        display: block;
    }
    .dynamicovPWA_notification_mask{
        background: rgba(0,0,0,0.2);
        position: absolute;
        width: 100%;
        height: 100%;
    }
    .dynamicovPWA_notification_container{
        background: #fff;
        position: absolute;
        bottom: 20px;
        left: 10px;
        right: 10px;
        width: calc(100% - 20px);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        box-sizing: border-box;
        box-shadow: 0 0 30px 0px rgba(0,0,0,0.15);
    }
    .dynamicovPWA_notification_image{
        width: 110px;
        height: 110px;
        border-radius: 50%;
        margin-top: -70px;
        margin-bottom: 20px;
    }
    .dynamicovPWA_notification_title{
        margin-top: 0;
        font-size: 1.4em;
        font-weight: bold;
        line-height: 1.2em;
        margin-bottom: 10px;
    }
    .dynamicovPWA_notification_description{
        margin-top: 0;
        font-size: 1.05em;
        padding-right: 10px;
        padding-left: 10px;
        font-weight: normal;
        opacity: 0.7;
        margin-bottom: 15px;
    }
    .dynamicovPWA_notification_button{
        padding: 10px;
        background: rgb(255, 105, 0);
        color: #fff;
        border-radius: 10px;
        cursor: pointer;
        display: none;
    }
    .dynamicovPWA_notification_icon svg{
        width: 25px;
        height: 25px;
        margin-bottom: 0px;
    }
    .dynamicovPWA_notification_instalinstructions{
        background: rgba(0,0,0,0.05);
        border-radius: 10px;
        padding: 5px 10px;
        display: none;
        font-size: 80%;
    }
    .dynamicovPWA_notification_close{
        position: absolute;
        right: 15px;
        opacity: 0.7;
        cursor: pointer;
       
    }
    .dynamicovPWA_notification_container_arrow{
        width: 20px;
        height: 20px;
        position: absolute;
        left: calc(50% - 10px);
        bottom: -9px;
        border-radius: 2px;
        background: #fff;
          -webkit-transform: rotate(45deg); 
     -moz-transform: rotate(45deg);  
      -ms-transform: rotate(45deg);   
       -o-transform: rotate(45deg);   
          transform: rotate(45deg);  
    }
    
    @media(min-width: 1000px){
        .dynamicovPWA_notification_container_arrow{
            display: none;
        }
        .dynamicovPWA_notification_container{
            max-width: 400px;
            bottom: 10px;
        }
    }
    
</style>

<div class="dynamicovPWA_notification" id="Dynamicov_PWAnotification">
    <div class="dynamicovPWA_notification_mask"></div>
    <div class="dynamicovPWA_notification_container">
        <div class="dynamicovPWA_notification_container_arrow"></div>
        <img src="/pwaicons/android-icon-192x192.png" class="dynamicovPWA_notification_image">
        <span class="dynamicovPWA_notification_close"><svg xmlns='http://www.w3.org/2000/svg' width='25' height='25' viewBox='0 0 512 512'><title>ionicons-v5-l</title><line x1='368' y1='368' x2='144' y2='144' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><line x1='368' y1='144' x2='144' y2='368' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/></svg></span>
        <p class="dynamicovPWA_notification_title">У нас появилось замечательное приложение</p>
        <p class="dynamicovPWA_notification_description">Скачайте его для легкого и удобного доступа к покупкам</p>
        <div class="dynamicovPWA_notification_button" id="dynamicovPWA_notification_installbutton">Установить приложение</div>
      
        <div class="dynamicovPWA_notification_instalinstructions">
            Для установки нажмите <span class="dynamicovPWA_notification_icon">
                <svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 400 512'><path d='M336,192h40a40,40,0,0,1,40,40V424a40,40,0,0,1-40,40H136a40,40,0,0,1-40-40V232a40,40,0,0,1,40-40h40' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><polyline points='336 128 256 48 176 128' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/><line x1='256' y1='321' x2='256' y2='48' style='fill:none;stroke:#0079ff;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/></svg>
            </span>,
            затем коснитесь «Добавить на экран "Домой"».
        </div>
    </div>
</div>

{% endblock %}
